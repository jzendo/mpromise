{"version":3,"sources":["status.js","util.js","index.js","extend.js"],"names":["ensureStatusProxy","expect","s","PENDING","FULFILLED","REJECTED","isPending","isFulfilled","isRejected","isResolved","isFunction","f","isObject","o","runAsync","fn","setTimeout","getDeferThrowError","error","promise","result","timer","handler","setupDeferThrow","status","status_","pendingHandlers_","length","value","value_","reject_","deferThrowErr_","teardownDeferThrow","clearTimeout","undefined","flushPendingHandlers","handlers","slice","forEach","Promise","promiseConstructor_","resolve_","bind","TypeError","then","once","callerProxy","val","call","fulfill_","e","fillWith_","onFulfilled","onRejected","handleFulfillProxy","resolve","reject","handleRejectProxy","err","PromiseConstructor","push","defer","pending","checkIterable","iterable","Array","isArray","Error","PromiseBase","v","count","resolvedCount","values","checkResolveProxy","idx","item"],"mappings":"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","file":"extend.js","sourceRoot":"..\\src","sourcesContent":["const ensureStatusProxy = expect => s => s === expect\r\n\r\nexport const PENDING = 'pending'\r\nexport const FULFILLED = 'fulfilled'\r\nexport const REJECTED = 'rejected'\r\n\r\nexport const isPending = ensureStatusProxy(PENDING)\r\nexport const isFulfilled = ensureStatusProxy(FULFILLED)\r\nexport const isRejected = ensureStatusProxy(REJECTED)\r\n\r\nexport const isResolved = s => isFulfilled(s) || isRejected(s)\r\n","import { isFulfilled, isRejected, isResolved } from './status'\r\n\r\nexport const isFunction = f => f && typeof f === 'function'\r\nexport const isObject = o => o && typeof o === 'object'\r\nexport const runAsync = fn => {\r\n  setTimeout(fn, 0)\r\n}\r\n\r\nconst getDeferThrowError = (error, promise) => {\r\n  const result = {\r\n    timer: setTimeout(() => {\r\n      result.handler(error)\r\n    }),\r\n    // Reset when unit test/...\r\n    handler: error => { throw error },\r\n    error\r\n  }\r\n\r\n  return result\r\n}\r\n\r\nexport const setupDeferThrow = promise => {\r\n  // Only for `extend`\r\n  if (process.env.IMPL === 'extend') {\r\n    if (promise) {\r\n      const status = promise.status_\r\n      // No rejected-handler\r\n      if (promise.pendingHandlers_.length == 0) {\r\n        // Throw when it is rejected\r\n        if (isRejected(status)) {\r\n          const value = promise.value_\r\n          // Mark rejected\r\n          promise.reject_(value)\r\n          // Defer throw\r\n          promise.deferThrowErr_ = getDeferThrowError(value, promise)\r\n          return true\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return false\r\n}\r\n\r\nexport const teardownDeferThrow = promise => {\r\n  // Only for `extend`\r\n  if (process.env.IMPL === 'extend') {\r\n    if (promise) {\r\n      if (promise.deferThrowErr_) {\r\n        clearTimeout(promise.deferThrowErr_.timer)\r\n        promise.deferThrowErr_ = undefined\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const flushPendingHandlers = promise => {\r\n  const status = promise.status_\r\n  if (!isResolved(status)) return\r\n\r\n  const handlers = promise.pendingHandlers_.slice(0)\r\n  const value = promise.value_\r\n\r\n  // Return when defer exception setup\r\n  if (setupDeferThrow(promise)) return\r\n\r\n  handlers.forEach(f => {\r\n    let handler\r\n\r\n    if (isFulfilled(status)) handler = f[0]\r\n    else if (isRejected(status)) handler = f[1]\r\n\r\n    if (handler) runAsync(() => handler(value))\r\n  })\r\n}\r\n","/*!\r\n *  A Promises/A+ implememt by jzendo\r\n *  - Specification: https://promisesaplus.com/\r\n */\r\n\r\nimport {\r\n  FULFILLED,\r\n  PENDING,\r\n  REJECTED,\r\n  isFulfilled,\r\n  isPending,\r\n  isRejected,\r\n  isResolved\r\n} from './status'\r\nimport {\r\n  flushPendingHandlers,\r\n  isFunction,\r\n  isObject,\r\n  runAsync,\r\n  teardownDeferThrow\r\n} from './util'\r\n\r\n/**\r\n *  @class Promise\r\n */\r\nclass Promise {\r\n  constructor (fn) {\r\n    this.status_ = PENDING\r\n    this.value_ = undefined\r\n    this.pendingHandlers_ = []\r\n    this.promiseConstructor_ = Promise\r\n\r\n    fn(this.resolve_.bind(this), this.reject_.bind(this))\r\n  }\r\n\r\n  resolve_ (value) {\r\n    if (isResolved(this.status_)) return\r\n\r\n    if (value === this) {\r\n      throw new TypeError('Chaining cycle detected for promise')\r\n    } else if (value instanceof this.promiseConstructor_) {\r\n      value.then(this.resolve_.bind(this), this.reject_.bind(this))\r\n    } else if (isFunction(value) || isObject(value)) {\r\n      let once = false\r\n\r\n      try {\r\n        const { then } = value\r\n\r\n        if (isFunction(then)) {\r\n          const callerProxy = fn => val => {\r\n            if (!once) {\r\n              fn(val)\r\n              once = true\r\n            }\r\n          }\r\n\r\n          then.call(\r\n            value,\r\n            callerProxy(this.resolve_.bind(this)),\r\n            callerProxy(this.reject_.bind(this))\r\n          )\r\n        } else {\r\n          this.fulfill_(value)\r\n        }\r\n      } catch (e) {\r\n        // https://promisesaplus.com/#point-55\r\n        // https://promisesaplus.com/#point-59\r\n        if (!once) this.reject_(e)\r\n      }\r\n    } else {\r\n      this.fulfill_(value)\r\n    }\r\n  }\r\n\r\n  fulfill_ (value) {\r\n    this.fillWith_(value, FULFILLED)\r\n  }\r\n\r\n  reject_ (value) {\r\n    this.fillWith_(value, REJECTED)\r\n  }\r\n\r\n  fillWith_ (value, status) {\r\n    if (isResolved(this.status_)) return\r\n\r\n    this.status_ = status\r\n    this.value_ = value\r\n\r\n    flushPendingHandlers(this)\r\n  }\r\n\r\n  then (onFulfilled, onRejected) {\r\n    teardownDeferThrow(this)\r\n\r\n    const { status_, value_ } = this\r\n\r\n    const handleFulfillProxy = (resolve, reject) => val => {\r\n      try {\r\n        if (isFunction(onFulfilled)) resolve(onFulfilled(val))\r\n        else resolve(val)\r\n      } catch (e) {\r\n        reject(e)\r\n      }\r\n    }\r\n\r\n    const handleRejectProxy = (resolve, reject) => err => {\r\n      try {\r\n        if (isFunction(onRejected)) resolve(onRejected(err))\r\n        else {\r\n          reject(err)\r\n        }\r\n      } catch (e) {\r\n        reject(e)\r\n      }\r\n    }\r\n\r\n    // Refer to Promise constructor\r\n    const PromiseConstructor = this.promiseConstructor_\r\n\r\n    // Status: pending\r\n    if (isPending(status_)) {\r\n      return new PromiseConstructor((resolve, reject) => {\r\n        this.pendingHandlers_.push([\r\n          handleFulfillProxy(resolve, reject),\r\n          handleRejectProxy(resolve, reject)\r\n        ])\r\n      })\r\n    }\r\n\r\n    // Status: fulfilled\r\n    if (isFulfilled(status_)) {\r\n      return new PromiseConstructor((resolve, reject) =>\r\n        // NOTE: onFulfilled should be called async mode\r\n        runAsync(() => {\r\n          handleFulfillProxy(resolve, reject)(value_)\r\n        })\r\n      )\r\n    }\r\n\r\n    // Status: rejected\r\n    if (isRejected(status_)) {\r\n      return new PromiseConstructor((resolve, reject) =>\r\n        // NOTE: onRejected should be called async mode\r\n        runAsync(() => {\r\n          handleRejectProxy(resolve, reject)(value_)\r\n        })\r\n      )\r\n    }\r\n\r\n    // throw new Error('invalid status')\r\n  }\r\n}\r\n\r\nexport default Promise\r\n\r\n// Generate `defer` util\r\nexport const defer = () => {\r\n  const pending = {}\r\n\r\n  pending.promise = new Promise((resolve, reject) => {\r\n    pending.resolve = resolve\r\n    pending.reject = reject\r\n  })\r\n\r\n  return pending\r\n}\r\n","import PromiseBase, { defer } from './index'\r\nimport { teardownDeferThrow } from './util'\r\n\r\nfunction checkIterable (iterable) {\r\n  // TODO: check iterable\r\n  if (!Array.isArray(iterable)) {\r\n    throw new Error('The first argument is not iterable (cannot read property Symbol(Symbol.iterator))')\r\n  }\r\n}\r\n\r\n/**\r\n * Extend Promise\r\n *\r\n * - Promise.resolve\r\n * - Promise.reject\r\n * - Promise.all\r\n * - Promise.race\r\n *\r\n * @class Promise\r\n */\r\nexport default class Promise extends PromiseBase {\r\n  constructor(fn) {\r\n    super(fn)\r\n    this.promiseConstructor_ = Promise\r\n  }\r\n\r\n  /**\r\n   * Handle exception\r\n   * @param {function | undefined} fn exception handler\r\n   */\r\n  catch (fn) {\r\n    teardownDeferThrow(this)\r\n    return this.then(undefined, fn)\r\n  }\r\n  /**\r\n   * @static Promise.resolve\r\n   * @param {*} v\r\n   */\r\n  static resolve (v) {\r\n    if (v instanceof Promise) return v\r\n\r\n    return new Promise((resolve, reject) => {\r\n      resolve(v)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @static Promise.reject\r\n   * @param {*} v\r\n   */\r\n  static reject (v) {\r\n    if (v instanceof Promise) return v\r\n\r\n    return new Promise((resolve, reject) => {\r\n      reject(v)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @static Promise.all\r\n   * @param {Iterable} iterable\r\n   */\r\n  static all (iterable) {\r\n    checkIterable(iterable)\r\n\r\n    const { promise, resolve, reject } = defer()\r\n\r\n    let count = 0\r\n    let resolvedCount = 0\r\n    const values = []\r\n\r\n    const checkResolveProxy = idx => value => {\r\n      resolvedCount++\r\n      values[idx] = value\r\n\r\n      if (resolvedCount >= count) {\r\n        resolve(values)\r\n      }\r\n    }\r\n\r\n    for (const item of iterable) {\r\n      count++\r\n\r\n      Promise.resolve(item)\r\n        .then(checkResolveProxy(count - 1), reject)\r\n    }\r\n\r\n    return promise\r\n  }\r\n\r\n  /**\r\n   * @static Promise.race\r\n   * @param {Iterable} iterable\r\n   */\r\n  static race (iterable) {\r\n    checkIterable(iterable)\r\n\r\n    const { promise, resolve, reject } = defer()\r\n\r\n    for (const item of iterable) {\r\n      Promise.resolve(item)\r\n        .then(resolve, reject)\r\n    }\r\n\r\n    return promise\r\n  }\r\n}\r\n\r\nexport {\r\n  defer\r\n}\r\n"]}